<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lecteur QR Code</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
        }

        #qrcode-reader {
            display: none;
        }
    </style>
</head>
<body>
    <h1>Lecteur QR Code</h1>
    <button onclick="activerCamera()">Scann</button>
    <input type="text" id="resultat" placeholder="Résultat du QR Code">
    <video id="qrcode-reader"></video>

    <script src="https://rawgit.com/schmich/instascan-builds/master/instascan.min.js"></script>
    <script>
        // Déclaration du scanner en dehors de la fonction activerCamera
        const scanner = new Instascan.Scanner({ video: document.getElementById('qrcode-reader') });

        // Ajout de l'événement 'scan' avant l'appel à activerCamera
        scanner.addListener('scan', function (content) {
            document.getElementById('resultat').value = content;
            // Vous pouvez ajouter d'autres actions après avoir lu le QR code si nécessaire
            // Par exemple, arrêter la caméra après la lecture
            scanner.stop();
            document.getElementById('qrcode-reader').style.display = 'none';
        });

        function activerCamera() {
            document.getElementById('qrcode-reader').style.display = 'block';

            // Demander l'accès à la caméra via HTTPS
            navigator.mediaDevices.getUserMedia({ video: true }).then(function (stream) {
                // Utilisez le flux vidéo
                scanner.start(stream);
            }).catch(function (error) {
                console.error('Erreur d\'accès à la caméra:', error);

                // Afficher un message d'erreur à l'utilisateur
                alert('Erreur d\'accès à la caméra. Veuillez vous assurer que l\'accès à la caméra est autorisé.');
            });
        }
    </script>
</body>
</html>
